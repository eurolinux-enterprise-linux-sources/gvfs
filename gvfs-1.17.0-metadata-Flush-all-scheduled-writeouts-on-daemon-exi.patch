diff -up gvfs-1.4.3/metadata/meta-daemon.c.bak gvfs-1.4.3/metadata/meta-daemon.c
--- gvfs-1.4.3/metadata/meta-daemon.c.bak	2013-05-07 18:49:57.000000000 +0200
+++ gvfs-1.4.3/metadata/meta-daemon.c	2013-05-07 18:54:34.000000000 +0200
@@ -79,6 +79,24 @@ tree_info_schedule_writeout (TreeInfo *i
     }
 }
 
+static void
+flush_single (const gchar *filename,
+              TreeInfo *info,
+              gpointer user_data)
+{
+  if (info->writeout_timeout != 0)
+    {
+      g_source_remove (info->writeout_timeout);
+      writeout_timeout (info);
+    }
+}
+
+static void
+flush_all ()
+{
+  g_hash_table_foreach (tree_infos, (GHFunc) flush_single, NULL);
+}
+
 static TreeInfo *
 tree_info_new (const char *filename)
 {
@@ -520,6 +538,7 @@ dbus_message_filter_func (DBusConnection
 				 DBUS_TYPE_INVALID) &&
 	  strcmp (name, G_VFS_DBUS_METADATA_NAME) == 0)
 	{
+	  flush_all();
 	  /* Someone else got the name (i.e. someone used --replace), exit */
 	  exit (1);
 	}
@@ -787,6 +806,8 @@ main (int argc, char *argv[])
 				      (GDestroyNotify)tree_info_free);
 
   g_main_loop_run (loop);
+  
+  flush_all();
 
   return 0;
 }
